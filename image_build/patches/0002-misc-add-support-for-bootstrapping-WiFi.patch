From 8886530d73703663fd5cc78cf5b43b9d2e7ccab2 Mon Sep 17 00:00:00 2001
From: dezeroku <dezeroku@gmail.com>
Date: Sun, 7 Jan 2024 08:41:36 +0100
Subject: [PATCH 2/2] misc: add support for bootstrapping WiFi

---
 raspi_master.yaml | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/raspi_master.yaml b/raspi_master.yaml
index ab7221b..a618082 100644
--- a/raspi_master.yaml
+++ b/raspi_master.yaml
@@ -140,6 +140,15 @@ steps:
       chmod 0600 /home/ansible_bootstrap/.ssh/authorized_keys
       echo "PermitRootLogin no\nPubkeyAuthentication yes\nPasswordAuthentication no\nAuthenticationMethods publickey" > /etc/ssh/sshd_config.d/01-basic-sshd-hardening.conf

+  # Set up the wireless connection
+  - chroot: tag-root
+    shell: |
+      echo "allow-hotplug wlan0" > /etc/network/interfaces.d/wlan0
+      echo "iface wlan0 inet dhcp"  >> /etc/network/interfaces.d/wlan0
+      #echo "iface wlan0 inet6 dhcp"  >> /etc/network/interfaces.d/wlan0
+      echo "    wpa-ssid $WIFI_SSID"  >> /etc/network/interfaces.d/wlan0
+      echo "    wpa-psk $WIFI_PASSWORD"  >> /etc/network/interfaces.d/wlan0
+
   # Clean up archive cache (likely not useful) and lists (likely outdated) to
   # reduce image size by several hundred megabytes.
   - chroot: tag-root
--
2.43.0
